# ネットワークプログラミングの勉強 with go
* [Go Web プログラミング](https://astaxie.gitbooks.io/build-web-application-with-golang/content/ja/)
* [ネットワークプログラミング](http://ash.jp/net/prog_net.htm)

# nc コマンド
[nc コマンド 使い方メモ](https://qiita.com/yasuhiroki/items/d470829ab2e30ee6203f)

# OSI参照モデル

https://www.itbook.info/study/p36.html

| プロトコル階層             | 規格             |
|:--------------------------:|:----------------:|
| 第7層 アプリケーション層   | HTTP, SMTP, POP3 |
| 第6層 プレゼンテーション層 | HTTP, SMTP, POP3 |
| 第5層 セッション層         | HTTP, SMTP, POP3 |
| 第4層 トランスポート層     | TCP/UDP          |
| 第3層 ネットワーク層       | IP               |
| 第2層 データリンク層       | イーサネット     |
| 第1層 物理層               | イーサネット     |

イーサネット規格は以下にまたがる規格
* 第2層 データリンク層
* 第1層 物理層

# トランスポート層
[TCP/UDP - コネクションとコネクションレス](https://www.itbook.info/study/tcp3.html)

トランスポート層の代表的なプロトコル
* TCP コネクション型
* UDP コネクションレス型

>ネットワーク層は、ノード間の通信を行う機能を提供するために、	IP アドレスを使用しています。
>
>IP アドレスはネットワークアドレスとホストアドレスに分かれていて、	どのネットワークのどのノードにパケットを転送すればよいかが	分かるようになっています。
>
>しかし、どのアプリケーションにデータを渡すのかは IP アドレスでは	知る事が出来ません。
>
>そこでトランスポート層では、「ポート番号」を使用して	どのアプリケーションに渡すべきなのかを判断しています。
>
>例えば 1 台のサーバでWebサーバとメールサーバという	２種類の役割を担っているサーバがあるとしましょう。 このサーバを仮に「SV-1」と呼びます。
>
>ちなみにこの役割のことを「サービス」と呼びまして、	それぞれのサービスをWebサービスやメールサービス	なんて呼びます。

## コネクション型・コネクションレス型
> トランスポート層ではの役割は「アプリケーションレベルでの通信を確立する」
> ことであって、そのためにポート番号を利用して制御をしています。
>
> TCP でも UDP でもそれぞれのヘッダにあて先、送信元のポート番号を
> 付与していて、アプリケーションの制御を実施しています。
>
> コネクション型とコネクションレス型の違いは、
> このアプリケーションの制御方法の違いに関係してきます。

## コネクション型
TCP など

> コネクション型はその名の通り、通信を確立するもの同士で
> 連絡を取り合って制御を行う方式です。
>
> 日常で見られるものに例えるのならば電話がまさにコネクション型。
>
> 電話は互いに受話器を持って話をします。
> 話をした言葉は相手にちゃんと届きますし、もし話している途中で
> うまく聞き取れないときには、相手に聞き返してもう一度同じ内容を
> 聞く事だって出来ます。
>
> このように、通信を確立するためにお互いが連絡を取り合って制御する
> 方式をコネクション型と呼んでいて、信頼性がある方式であるといえます。
>
> コネクション型の代表的なプロトコルには「TCP」があります。

## コネクションレス型
UDPなど

> コネクションレス型は、連絡を取り合って制御はせずに、相手が受け取る
> 準備ができているかにかかわらず、送信してしまう方式です。
>
> 手紙はまさにコネクションレス型です。
> 相手が何をしていようと手紙を送りつけて、基本的にいつ届くのかは
> わかりませんし、もしかしたらどこかで紛失してしまい、
> 相手に届かないこともあるかもしれません。
>
> このようにコネクションレス型は、相手が何をしているかは関係なしに
> 送りつける方式です。
> もちろん途中でパケットが消失してしまったり、
> 到着順も考慮していません。
>
> そのためコネクションレス型通信は信頼性のない通信と言われています。
>
> ただし、メリットもあるわけで、コネクション型はお互いが連絡を取り合う
> 必要があることから、安定した通信を実現できるものの、
> 確認のためのデータのやり取りが発生することから、
> ネットワークのトラフィックが増大してしまうデメリットがありますが、
> 逆にコネクションレス型はネットワークへの負荷が軽いため
> 通信の効率が良いメリットがあります。
>
> コネクションレス型の代表的なプロトコルには「UDP」があります。


# ソケット通信
http://cuto.unirita.co.jp/gostudy/post/socket/
## ソケットとは
インターネットを利用するアプリケーションを作ろうというとき、直接コーディングに影響がありそうなのは、前節で紹介したようなアプリケーション層のプロトコルでしょう。 Go言語にもHTTPを扱う機能が組み込まれているので、そのAPIを使うことで、HTTPやその上のプロトコルを利用したアプリケーションを開発できます。

では、HTTPそのものはどのような仕組みで下位のレイヤーを使っているのでしょうか。 現在、ほとんどのOSでは、アプリケーション層からトランスポート層のプロトコルを利用するときのAPIとしてソケットという仕組みを利用しています。

一般に、他のアプリケーションとの通信のことをプロセス間通信（IPC：Inter Process Communication）と呼びます。 OSには、シグナル、メッセージキュー、パイプ、共有メモリなど、数多くのプロセス間通信機能が用意されています。 ソケットも、そのようなプロセス間通信の一種です。 ソケットが他のプロセス間通信と少し違うのは、アドレスとポート番号が分かればローカルのコンピュータ内だけではなく外部のコンピュータとも通信が行える点です。

アプリケーション間のインターネット通信も、このソケットを通じて行います。 たとえば通常のブラウザを利用したHTTP通信では、サーバのTCPポート80番に対して、ソケットを使ったプロセス間通信を行います。
http://ascii.jp/elem/000/001/276/1276572/

## ソケット通信の基本構造
どんなソケット通信も、基本となる構成は次のような形態です。

サーバ：ソケットを開いて待ち受ける
クライアント：開いているソケットに接続し、通信を行う
Go言語の場合、サーバが呼ぶのはListen()メソッド、クライアントが呼ぶのはDial()メソッドというAPIの命名ルールが決まっており、ソケット通信でも同様です。

通信の手順はプロトコルによって異なります。 一方的な送信しかできないUDPのようなプロトコルもあれば、接続時にサーバがクライアントを認知（Accept()）して双方向にやり取りができるようになるTCPやUnixドメインソケットなどのプロトコルもあります。

Go言語におけるTCPソケットを使った通信のライフサイクルは次の図のようにまとめられます （この図ではサーバから通信を切断していますが、クライアントから切断することもできます）。

# echo サーバ
## echo(エコー)サーバー とは
> echoサーバーとは、受け取ったリクエスト内容をそのままレスポンスするサーバーのことです。
> 普通のサーバーは受け取ったリクエストに対してレスポンス内容を生成して送りますが、echoサーバーでは内部の処理を行いません。
> そのため、利用する言語のTCPサーバーとしての理論的な最高のパフォーマンスを出すことができます
https://qiita.com/kawasin73/items/3371d35166af733c2ce4

## 実装の流れ
* TCPを使う
* ポートを指定して待ち受ける
* リクエストを受け付けたら、受け取った文字列をそのまま送り返す
http://hachibeechan.hateblo.jp/entry/2013/09/24/Go%E8%A8%80%E8%AA%9E%E3%81%A7%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E3%81%B9%E3%82%93%E3%81%8D%E3%82%87%E3%81%86

もう少し詳しく

* ソケットを作成する
* ソケットをバインドする
* Listen状態になる
* コネクションを取り出す
* クライアントから文字列を受け取る
* クライアントへ文字列を返す
http://blog.bati11.info/entry/2017/03/03/223933


## Go での実装
[GoでたたくTCPソケット（前編）](http://ascii.jp/elem/000/001/276/1276572/)

### プロトコルとレイヤー
| レイヤーの名称     | 代表的なプロトコル  |
| :---               | :---                |
| アプリケーション層 | HTTP                |
| トランスポート層   | TCP/UDP/QUIC        |
| インターネット層   | IP                  |
| リンク層           | Wi-Fi、イーサネット |

> このうち、アプリケーションを作るために気にする必要があるのはトランスポート層よりも上のレイヤーだけです。 実際のインターネット通信では、ケーブルや無線を通してIPパケットの形でデータがやり取りされますが、 アプリケーションで直接IPパケットを作ったりするわけではありません。 HTTPやTCPのレベルで決められているルールに従って通信をすれば、それより下のレイヤーで必要になる詳細を気にすることなく、 ネットワークの向こう側にあるアプリケーションとやり取りができるわけです。

> Go言語では、HTTP、TCP、UDPについて組み込みの機能が提供されています。 実用的なアプリケーションでは、それらの機能を使って、自分のアプリケーションに必要なプロトコルを実装していくことになります。

# http サーバ (web サーバ)
